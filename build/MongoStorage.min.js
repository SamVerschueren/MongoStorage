/**
 * MongoStorage v0.0.1 2014-11-14
 * (c) Sam Verschueren
 * License: MIT
 */
var Collection=function(){"use strict";function a(a,b){this._name=a,this._data=b}return"undefined"==typeof _?void console.error("Lodash not found! Please include lodash."):(a.prototype.find=function(b,c,d){_.isFunction(b)&&(d=b,c={},b={}),_.isFunction(c)&&(d=c,c={});var e=_.filter(_.values(this._data),compileDocumentSelector(b));c&&c.sort&&(e=e.sort(a._compileSort(c.sort)));var f=c.skip||0,g=c.limit?c.limit+f:e.length;d(e.slice(f,g))},a.prototype.findOne=function(b,c,d){_.isFunction(b)&&(d=b,c=void 0,b={}),_.isFunction(c)&&(d=c,c=void 0);var e=_.filter(_.values(this._data),compileDocumentSelector(b));c&&c.sort&&(e=e.sort(a._compileSort(c.sort))),d(e[0])},a.prototype.update=function(b,c,d,e){_.isFunction(d)&&(e=d,d={});var f=this,g=0;if(f.find(b,function(b){d&&d.multi||(b=0==b.length?[]:[b[0]]),_.forEach(b,function(b){a._modify(b,c,d);var e=_.findIndex(f._data,{_id:b._id});f._data[e]=b,window.localStorage.setObject(f._name,f._data),++g})}),0==g&&d.upsert){var h=b;a._modify(h,c,{isInsert:!0});try{h._id=new ObjectId(h._id).toJSONValue()}catch(i){h._id=(new ObjectId).toJSONValue()}f._data.push(h),window.localStorage.setObject(f._name,f._data),g=1}e&&e(g)},a.prototype.insert=function(a,b){var c=a;_.isArray(a)||(c=[a]),_.forEach(c,function(a){a._id=(new ObjectId).toJSONValue(),this._data.push(a)},this),window.localStorage.setObject(this._name,this._data),b&&b()},a.prototype.remove=function(a,b){_.isFunction(a)&&(b=a,a=void 0);var c=this._data.length;if(a){var d=this;this.find(a,function(a){c=a.length,_.each(a,function(a){var b=_.findIndex(d._data,{_id:a._id});d._data.splice(b,1)},this)},this)}else this._data=[];window.localStorage.setObject(this._name,this._data),b&&b(c)},a.prototype.count=function(a,b){_.isFunction(a)&&(b=a,a={}),this.find(a,function(a){b(a.length)})},a.prototype.drop=function(a){window.localStorage.removeItem(this._name),a&&a()},a)}();"undefined"!=typeof module&&(module.exports=Collection),Collection._modify=function(a,b,c){if(c=c||{},!_.isObject(b))throw Error("Modifier must be an object");var d,e=isOperatorObject(b);if(e)d=EJSON.clone(a),_.each(b,function(a,b){var e=MODIFIERS[b];if(c.isInsert&&"$setOnInsert"===b&&(e=MODIFIERS.$set),!e)throw Error("Invalid modifier specified "+b);_.each(a,function(a,f){if(f.length&&"."===f[f.length-1])throw Error("Invalid mod field name, may not end in a period");if("_id"===f)throw Error("Mod on _id not allowed");var g=f.split("."),h=(_.has(NO_CREATE_MODIFIERS,b),findModTarget(d,g,{noCreate:NO_CREATE_MODIFIERS[b],forbidArray:"$rename"===b,arrayIndices:c.arrayIndices})),i=g.pop();e(h,i,a,f,d)})});else{if(b._id&&!EJSON.equals(a._id,b._id))throw Error("Cannot change the _id of a document");for(var f in b)if(/\./.test(f))throw Error("When replacing document, field name may not contain '.'");d=b}_.each(_.keys(a),function(b){("_id"!==b||c.isInsert)&&delete a[b]}),_.each(d,function(b,c){a[c]=b})};var findModTarget=function(a,b,c){c=c||{};for(var d=!1,e=0;e<b.length;e++){var f=e===b.length-1,g=b[e],h=isIndexable(a);if(!h){if(c.noCreate)return void 0;var i=Error("cannot use the part '"+g+"' to traverse "+a);throw i.setPropertyError=!0,i}if(a instanceof Array){if(c.forbidArray)return null;if("$"===g){if(d)throw Error("Too many positional (i.e. '$') elements");if(!c.arrayIndices||!c.arrayIndices.length)throw Error("The positional operator did not find the match needed from the query");g=c.arrayIndices[0],d=!0}else{if(!isNumericKey(g)){if(c.noCreate)return void 0;throw Error("can't append to array using string field name ["+g+"]")}g=parseInt(g)}if(f&&(b[e]=g),c.noCreate&&g>=a.length)return void 0;for(;a.length<g;)a.push(null);if(!f)if(a.length===g)a.push({});else if("object"!=typeof a[g])throw Error("can't modify field '"+b[e+1]+"' of list value "+JSON.stringify(a[g]))}else{if(g.length&&"$"===g.substr(0,1))throw Error("can't set field named "+g);if(!(g in a)){if(c.noCreate)return void 0;f||(a[g]={})}}if(f)return a;a=a[g]}},NO_CREATE_MODIFIERS={$unset:!0,$pop:!0,$rename:!0,$pull:!0,$pullAll:!0},MODIFIERS={$inc:function(a,b,c){if("number"!=typeof c)throw Error("Modifier $inc allowed for numbers only");if(b in a){if("number"!=typeof a[b])throw Error("Cannot apply $inc modifier to non-number");a[b]+=c}else a[b]=c},$set:function(a,b,c){if(!_.isObject(a)){var d=Error("Cannot set property on non-object field");throw d.setPropertyError=!0,d}if(null===a){var d=Error("Cannot set property on null");throw d.setPropertyError=!0,d}a[b]=EJSON.clone(c)},$setOnInsert:function(){},$unset:function(a,b){console.log("unset"),void 0!==a&&(a instanceof Array?b in a&&(a[b]=null):delete a[b])},$push:function(a,b,c){if(void 0===a[b]&&(a[b]=[]),!(a[b]instanceof Array))throw Error("Cannot apply $push modifier to non-array");if(!c||!c.$each)return void a[b].push(EJSON.clone(c));var d=c.$each;if(!(d instanceof Array))throw Error("$each must be an array");var e=void 0;if("$slice"in c){if("number"!=typeof c.$slice)throw Error("$slice must be a numeric value");if(c.$slice>0)throw Error("$slice in $push must be zero or negative");e=c.$slice}var f=void 0;if(c.$sort){if(void 0===e)throw Error("$sort requires $slice to be present");f=new Minimongo.Sorter(c.$sort).getComparator();for(var g=0;g<d.length;g++)if(3!==Collection._f._type(d[g]))throw Error("$push like modifiers using $sort require all elements to be objects")}for(var h=0;h<d.length;h++)a[b].push(EJSON.clone(d[h]));f&&a[b].sort(f),void 0!==e&&(a[b]=0===e?[]:a[b].slice(e))},$pushAll:function(a,b,c){if(!("object"==typeof c&&c instanceof Array))throw Error("Modifier $pushAll/pullAll allowed for arrays only");var d=a[b];if(void 0===d)a[b]=c;else{if(!(d instanceof Array))throw Error("Cannot apply $pushAll modifier to non-array");for(var e=0;e<c.length;e++)d.push(c[e])}},$addToSet:function(a,b,c){var d=!1;if("object"==typeof c)for(var e in c){"$each"===e&&(d=!0);break}var f=d?c.$each:[c],g=a[b];if(void 0===g)a[b]=f;else{if(!(g instanceof Array))throw Error("Cannot apply $addToSet modifier to non-array");_.each(f,function(a){for(var b=0;b<g.length;b++)if(Collection._f._equal(a,g[b]))return;g.push(EJSON.clone(a))})}},$pop:function(a,b,c){if(void 0!==a){var d=a[b];if(void 0!==d){if(!(d instanceof Array))throw Error("Cannot apply $pop modifier to non-array");"number"==typeof c&&0>c?d.splice(0,1):d.pop()}}},$pull:function(a,b,c){if(void 0!==a){var d=a[b];if(void 0!==d){if(!(d instanceof Array))throw Error("Cannot apply $pull/pullAll modifier to non-array");var e=[];if("object"!=typeof c||c instanceof Array)for(var f=0;f<d.length;f++)Collection._f._equal(d[f],c)||e.push(d[f]);else for(var g=new Minimongo.Matcher(c),f=0;f<d.length;f++)g.documentMatches(d[f]).result||e.push(d[f]);a[b]=e}}},$pullAll:function(a,b,c){if(!("object"==typeof c&&c instanceof Array))throw Error("Modifier $pushAll/pullAll allowed for arrays only");if(void 0!==a){var d=a[b];if(void 0!==d){if(!(d instanceof Array))throw Error("Cannot apply $pull/pullAll modifier to non-array");for(var e=[],f=0;f<d.length;f++){for(var g=!1,h=0;h<c.length;h++)if(Collection._f._equal(d[f],c[h])){g=!0;break}g||e.push(d[f])}a[b]=e}}},$rename:function(a,b,c,d,e){if(d===c)throw Error("$rename source must differ from target");if(null===a)throw Error("$rename source field invalid");if("string"!=typeof c)throw Error("$rename target must be a string");if(void 0!==a){var f=a[b];delete a[b];var g=c.split("."),h=findModTarget(e,g,{forbidArray:!0});if(null===h)throw Error("$rename target field invalid");var i=g.pop();h[i]=f}},$bit:function(){throw Error("$bit is not supported")}};isArray=function(a){return _.isArray(a)&&!EJSON.isBinary(a)},isPlainObject=Collection._isPlainObject=function(a){return a&&_.isObject(a)},isIndexable=function(a){return isArray(a)||isPlainObject(a)},isOperatorObject=function(a,b){if(!isPlainObject(a))return!1;var c=void 0;return _.each(a,function(d,e){var f="$"===e.substr(0,1);if(void 0===c)c=f;else if(c!==f){if(!b)throw new Error("Inconsistent operator: "+JSON.stringify(a));c=!1}}),!!c},isNumericKey=function(a){return/^[0-9]+$/.test(a)};var isArray=function(a){return _.isArray(a)&&!EJSON.isBinary(a)},_anyIfArray=function(a,b){return isArray(a)?_.any(a,b):b(a)},_anyIfArrayPlus=function(a,b){return b(a)?!0:isArray(a)&&_.any(a,b)},hasOperators=function(a){var b=void 0;for(var c in a){var d="$"===c.substr(0,1);if(void 0===b)b=d;else if(b!==d)throw new Error("Inconsistent selector: "+a)}return!!b},compileValueSelector=function(a){if(null==a)return function(a){return _anyIfArray(a,function(a){return null==a})};if(!_.isObject(a))return function(b){return _anyIfArray(b,function(b){return b===a})};if(a instanceof RegExp)return function(b){return void 0===b?!1:_anyIfArray(b,function(b){return a.test(b)})};if(isArray(a))return function(b){return isArray(b)?_anyIfArrayPlus(b,function(b){return Collection._f._equal(a,b)}):!1};if(hasOperators(a)){var b=[];return _.each(a,function(c,d){if(!_.has(VALUE_OPERATORS,d))throw new Error("Unrecognized operator: "+d);b.push(VALUE_OPERATORS[d](c,a.$options))}),function(a){return _.all(b,function(b){return b(a)})}}return function(b){return _anyIfArray(b,function(b){return Collection._f._equal(a,b)})}},LOGICAL_OPERATORS={$and:function(a){if(!isArray(a)||_.isEmpty(a))throw Error("$and/$or/$nor must be nonempty array");var b=_.map(a,compileDocumentSelector);return function(a){return _.all(b,function(b){return b(a)})}},$or:function(a){if(!isArray(a)||_.isEmpty(a))throw Error("$and/$or/$nor must be nonempty array");var b=_.map(a,compileDocumentSelector);return function(a){return _.any(b,function(b){return b(a)})}},$nor:function(a){if(!isArray(a)||_.isEmpty(a))throw Error("$and/$or/$nor must be nonempty array");var b=_.map(a,compileDocumentSelector);return function(a){return _.all(b,function(b){return!b(a)})}},$where:function(a){return a instanceof Function||(a=Function("return "+a)),function(b){return a.call(b)}}},VALUE_OPERATORS={$in:function(a){if(!isArray(a))throw new Error("Argument to $in must be array");return function(b){return _anyIfArrayPlus(b,function(b){return _.any(a,function(a){return Collection._f._equal(a,b)})})}},$all:function(a){if(!isArray(a))throw new Error("Argument to $all must be array");return function(b){return isArray(b)?_.all(a,function(a){return _.any(b,function(b){return Collection._f._equal(a,b)})}):!1}},$lt:function(a){return function(b){return _anyIfArray(b,function(b){return Collection._f._cmp(b,a)<0})}},$lte:function(a){return function(b){return _anyIfArray(b,function(b){return Collection._f._cmp(b,a)<=0})}},$gt:function(a){return function(b){return _anyIfArray(b,function(b){return Collection._f._cmp(b,a)>0})}},$gte:function(a){return function(b){return _anyIfArray(b,function(b){return Collection._f._cmp(b,a)>=0})}},$ne:function(a){return function(b){return!_anyIfArrayPlus(b,function(b){return Collection._f._equal(b,a)})}},$nin:function(a){if(!isArray(a))throw new Error("Argument to $nin must be array");var b=VALUE_OPERATORS.$in(a);return function(a){return void 0===a?!0:!b(a)}},$exists:function(a){return function(b){return a===(void 0!==b)}},$mod:function(a){var b=a[0],c=a[1];return function(a){return _anyIfArray(a,function(a){return a%b===c})}},$size:function(a){return function(b){return isArray(b)&&a===b.length}},$type:function(a){return function(b){return void 0===b?!1:_anyIfArray(b,function(b){return Collection._f._type(b)===a})}},$regex:function(a,b){if(void 0!==b){if(/[^gim]/.test(b))throw new Error("Only the i, m, and g regexp options are supported");var c=a instanceof RegExp?a.source:a;a=new RegExp(c,b)}else a instanceof RegExp||(a=new RegExp(a));return function(b){return void 0===b?!1:_anyIfArray(b,function(b){return a.test(b)})}},$options:function(){return function(){return!0}},$elemMatch:function(a){var b=compileDocumentSelector(a);return function(a){return isArray(a)?_.any(a,function(a){return b(a)}):!1}},$not:function(a){var b=compileValueSelector(a);return function(a){return!b(a)}},$near:function(){return function(){return!0}},$geoIntersects:function(){return function(){return!0}}};Collection._f={_type:function(a){return"number"==typeof a?1:"string"==typeof a?2:"boolean"==typeof a?8:isArray(a)?4:null===a?10:a instanceof RegExp?11:"function"==typeof a?13:a instanceof Date?9:EJSON.isBinary(a)?5:a instanceof Meteor.Collection.ObjectID?7:3},_equal:function(a,b){return EJSON.equals(a,b,{keyOrderSensitive:!0})},_typeorder:function(a){return[-1,1,2,3,4,5,-1,6,7,8,0,9,-1,100,2,100,1,8,1][a]},_cmp:function(a,b){if(void 0===a)return void 0===b?0:-1;if(void 0===b)return 1;var c=Collection._f._type(a),d=Collection._f._type(b),e=Collection._f._typeorder(c),f=Collection._f._typeorder(d);if(e!==f)return f>e?-1:1;if(c!==d)throw Error("Missing type coercion logic in _cmp");if(7===c&&(c=d=2,a=a.toHexString(),b=b.toHexString()),9===c&&(c=d=1,a=a.getTime(),b=b.getTime()),1===c)return a-b;if(2===d)return b>a?-1:a===b?0:1;if(3===c){var g=function(a){var b=[];for(var c in a)b.push(c),b.push(a[c]);return b};return Collection._f._cmp(g(a),g(b))}if(4===c)for(var h=0;;h++){if(h===a.length)return h===b.length?0:-1;if(h===b.length)return 1;var i=Collection._f._cmp(a[h],b[h]);if(0!==i)return i}if(5===c){if(a.length!==b.length)return a.length-b.length;for(h=0;h<a.length;h++){if(a[h]<b[h])return-1;if(a[h]>b[h])return 1}return 0}if(8===c)return a?b?0:1:b?-1:0;if(10===c)return 0;if(11===c)throw Error("Sorting not supported on regular expression");if(13===c)throw Error("Sorting not supported on Javascript code");throw Error("Unknown type to sort")}},Collection._matches=function(a,b){return Collection._compileSelector(a)(b)},Collection._makeLookupFunction=function(a){var b,c,d,e=a.indexOf(".");if(-1===e)b=a;else{b=a.substr(0,e);var f=a.substr(e+1);c=Collection._makeLookupFunction(f),d=/^\d+(\.|$)/.test(f)}return function(a){if(null==a)return[void 0];var e=a[b];return c?isArray(e)&&0===e.length?[void 0]:((!isArray(e)||d)&&(e=[e]),Array.prototype.concat.apply([],_.map(e,c))):[e]}};var compileDocumentSelector=function(a){var b=[];return _.each(a,function(a,c){if("$"===c.substr(0,1)){if(!_.has(LOGICAL_OPERATORS,c))throw new Error("Unrecognized logical operator: "+c);b.push(LOGICAL_OPERATORS[c](a))}else{var d=Collection._makeLookupFunction(c),e=compileValueSelector(a);b.push(function(a){var b=d(a);return _.any(b,e)})}}),function(a){return _.all(b,function(b){return b(a)})}};Collection._compileSelector=function(a){if(a instanceof Function)return function(b){return a.call(b)};if(Collection._selectorIsId(a))return function(b){return EJSON.equals(b._id,a)};if(!a||"_id"in a&&!a._id)return function(){return!1};if("boolean"==typeof a||isArray(a)||EJSON.isBinary(a))throw new Error("Invalid selector: "+a);return compileDocumentSelector(a)},Collection._compileSort=function(a){var b=[];if(a instanceof Array)for(var c=0;c<a.length;c++)b.push("string"==typeof a[c]?{lookup:Collection._makeLookupFunction(a[c]),ascending:!0}:{lookup:Collection._makeLookupFunction(a[c][0]),ascending:"desc"!==a[c][1]});else{if("object"!=typeof a)throw Error("Bad sort specification: ",JSON.stringify(a));for(var d in a)b.push({lookup:Collection._makeLookupFunction(d),ascending:a[d]>=0})}if(0===b.length)return function(){return 0};var e=function(a,b){var c,d=!0;return _.each(a,function(a){isArray(a)||(a=[a]),isArray(a)&&0===a.length&&(a=[void 0]),_.each(a,function(a){if(d)c=a,d=!1;else{var e=Collection._f._cmp(c,a);(b&&e>0||!b&&0>e)&&(c=a)}})}),c};return function(a,c){for(var d=0;d<b.length;++d){var f=b[d],g=e(f.lookup(a),f.ascending),h=e(f.lookup(c),f.ascending),i=Collection._f._cmp(g,h);if(0!==i)return f.ascending?i:-i}return 0}},EJSON={};var customTypes={};EJSON.addType=function(a,b){if(_.has(customTypes,a))throw new Error("Type "+a+" already present");customTypes[a]=b};var builtinConverters=[{matchJSONValue:function(a){return _.has(a,"$date")&&1===_.size(a)},matchObject:function(a){return a instanceof Date},toJSONValue:function(a){return{$date:a.getTime()}},fromJSONValue:function(a){return new Date(a.$date)}},{matchJSONValue:function(a){return _.has(a,"$binary")&&1===_.size(a)},matchObject:function(a){return"undefined"!=typeof Uint8Array&&a instanceof Uint8Array||a&&_.has(a,"$Uint8ArrayPolyfill")},toJSONValue:function(a){return{$binary:EJSON._base64Encode(a)}},fromJSONValue:function(a){return EJSON._base64Decode(a.$binary)}},{matchJSONValue:function(a){return _.has(a,"$escape")&&1===_.size(a)},matchObject:function(a){return _.isEmpty(a)||_.size(a)>2?!1:_.any(builtinConverters,function(b){return b.matchJSONValue(a)})},toJSONValue:function(a){var b={};return _.each(a,function(a,c){b[c]=EJSON.toJSONValue(a)}),{$escape:b}},fromJSONValue:function(a){var b={};return _.each(a.$escape,function(a,c){b[c]=EJSON.fromJSONValue(a)}),b}},{matchJSONValue:function(a){return _.has(a,"$type")&&_.has(a,"$value")&&2===_.size(a)},matchObject:function(a){return EJSON._isCustomType(a)},toJSONValue:function(a){return{$type:a.typeName(),$value:a.toJSONValue()}},fromJSONValue:function(a){var b=a.$type,c=customTypes[b];return c(a.$value)}}];EJSON._isCustomType=function(a){return a&&"function"==typeof a.toJSONValue&&"function"==typeof a.typeName&&_.has(customTypes,a.typeName())};var adjustTypesToJSONValue=EJSON._adjustTypesToJSONValue=function(a){if(null===a)return null;var b=toJSONValueHelper(a);return void 0!==b?b:(_.each(a,function(b,c){if("object"==typeof b||void 0===b){var d=toJSONValueHelper(b);return d?void(a[c]=d):void adjustTypesToJSONValue(b)}}),a)},toJSONValueHelper=function(a){for(var b=0;b<builtinConverters.length;b++){var c=builtinConverters[b];if(c.matchObject(a))return c.toJSONValue(a)}return void 0};EJSON.toJSONValue=function(a){var b=toJSONValueHelper(a);return void 0!==b?b:("object"==typeof a&&(a=EJSON.clone(a),adjustTypesToJSONValue(a)),a)};var adjustTypesFromJSONValue=EJSON._adjustTypesFromJSONValue=function(a){if(null===a)return null;var b=fromJSONValueHelper(a);return b!==a?b:(_.each(a,function(b,c){if("object"==typeof b){var d=fromJSONValueHelper(b);if(b!==d)return void(a[c]=d);adjustTypesFromJSONValue(b)}}),a)},fromJSONValueHelper=function(a){if("object"==typeof a&&null!==a&&_.size(a)<=2&&_.all(a,function(a,b){return"string"==typeof b&&"$"===b.substr(0,1)}))for(var b=0;b<builtinConverters.length;b++){var c=builtinConverters[b];if(c.matchJSONValue(a))return c.fromJSONValue(a)}return a};EJSON.fromJSONValue=function(a){var b=fromJSONValueHelper(a);return b===a&&"object"==typeof a?(a=EJSON.clone(a),adjustTypesFromJSONValue(a),a):b},EJSON.stringify=function(a){return JSON.stringify(EJSON.toJSONValue(a))},EJSON.parse=function(a){return EJSON.fromJSONValue(JSON.parse(a))},EJSON.isBinary=function(a){return"undefined"!=typeof Uint8Array&&a instanceof Uint8Array||a&&a.$Uint8ArrayPolyfill},EJSON.equals=function(a,b,c){var d,e=!(!c||!c.keyOrderSensitive);if(a===b)return!0;if(!a||!b)return!1;if("object"!=typeof a||"object"!=typeof b)return!1;if(a instanceof Date&&b instanceof Date)return a.valueOf()===b.valueOf();if(EJSON.isBinary(a)&&EJSON.isBinary(b)){if(a.length!==b.length)return!1;for(d=0;d<a.length;d++)if(a[d]!==b[d])return!1;return!0}if("function"==typeof a.equals)return a.equals(b,c);if(a instanceof Array){if(!(b instanceof Array))return!1;if(a.length!==b.length)return!1;for(d=0;d<a.length;d++)if(!EJSON.equals(a[d],b[d],c))return!1;return!0}var f;if(e){var g=[];return _.each(b,function(a,b){g.push(b)}),d=0,f=_.all(a,function(a,e){return d>=g.length?!1:e!==g[d]?!1:EJSON.equals(a,b[g[d]],c)?(d++,!0):!1}),f&&d===g.length}return d=0,f=_.all(a,function(a,e){return _.has(b,e)&&EJSON.equals(a,b[e],c)?(d++,!0):!1}),f&&_.size(b)===d},EJSON.clone=function(a){var b;if("object"!=typeof a)return a;if(null===a)return null;if(a instanceof Date)return new Date(a.getTime());if(EJSON.isBinary(a)){b=EJSON.newBinary(a.length);for(var c=0;c<a.length;c++)b[c]=a[c];return b}if(_.isArray(a)||_.isArguments(a)){for(b=[],c=0;c<a.length;c++)b[c]=EJSON.clone(a[c]);return b}return"function"==typeof a.clone?a.clone():(b={},_.each(a,function(a,c){b[c]=EJSON.clone(a)}),b)},Storage.prototype.setObject=function(a,b){this.setItem(a,EJSON.stringify(b))},Storage.prototype.getObject=function(a){var b=this.getItem(a);return b?EJSON.parse(b):void 0};var MongoStorage=function(){"use strict";function a(){}return"undefined"==typeof _?void console.error("Lodash not found! Please include lodash."):(a.prototype.use=function(a){this._database=a;for(var b in window.localStorage)0===b.indexOf(this._database)&&(console.log(b.substring(this._database.length+1)),this[b.substring(this._database.length+1)]=new Collection(b,window.localStorage.getObject(b)))},a.prototype.createCollection=function(a){if(void 0===this._database)throw{errmsg:"no database selected",ok:0};var b=this._database+"."+a;if(void 0!==window.localStorage.getObject(b))throw{errmsg:"collection already exists",ok:0};window.localStorage.setObject(b,[]),this[a]=new Collection(b,[])},a)}(),ObjectId=function(){"use strict";function a(a){if(a){if(a=a.toLowerCase(),!this._isObjectId(a))throw new Error("Could not parse "+a+" as a hexadecimal string");this._timestamp=parseInt(a.substr(0,8),16),this._id=a}else{for(this._timestamp=parseInt(Date.now()/1e3),this._index=(b++).toString(16);this._index.length<6;)this._index="0"+this._index;this._id=this._timestamp.toString(16)+c+d+this._index}}var b=_.random(0,5592405),c=_.random(1048576,16777215).toString(16),d=_.random(4096,65535).toString(16);return a.prototype._isObjectId=function(a){return 24===a.length&&!!a.match(/^[0-9a-f]*$/)},a.prototype.getTimestamp=function(){return this._timestamp},a.prototype.toString=function(){return'ObjectId("'+this._id+'")'},a.prototype.valueOf=a.prototype.toJSONValue=a.prototype.toHexString=function(){return this._id},a}();
//# sourceMappingURL=MongoStorage.min.js.map